---
title: 使用R语言绘制图形
date: 2019-11-23
categories:
  - R语言
  - 绘图
tags:
  - R语言绘图
keywords:
  - R语言
  - 绘图
thumbnailImagePosition: left
thumbnailImage: https
---

统计类图形本质上是将数据的统计信息映射到图形的某种属性（位置、形状、大小、颜色等）。这篇文章我们不仅会介绍如何在R语言中绘制各类基础图形，还会介绍各种常见统计类图形的意义及绘制方式。

<!--more-->

<!-- toc -->

计算机图像都可以看作是由**像素点阵**组成的，但R语言中几乎所有的绘图函数，都是根据**坐标系统**绘制图形的。当然我们也可以使用以下命令，将坐标系统调整到与像素点阵一样大小，从而实现按像素点绘图。注意其中**w、h**分别表示图像横竖方向像素点的个数；此外R语言中绘制图形时，总是以图像左下角为坐标系统原点。

```R
w <- 480; h <- 480
png(filename = "Rplot.png", width = w, height = h)
par(mar = rep(0, 4), xaxs = "i", yaxs = "i")
plot.new()
plot.window(xlim = c(1, w), ylim = c(1, h))
```

<br>

## 1、基础图形

以下基础绘图函数，可以允许我们在R语言中绘制点、线、面、文字与图像等，基本上可以实现绝大多数情况下的绘图需求。

之前我们已经介绍过了R语言中的系统绘图参数（参考**par**函数），下面要介绍到的基础绘图函数，基本上都会调用**par**中的参数或者向**par**传递参数。某些参数在以下基础绘图函数和**par**函数中名称相同，但是却可能拥有不同的意义。所以我们应当尽量将与图形相关的设置交由基础绘图函数处理，比如图形的位置、大小、颜色等；而将图像布局等设置交由**par**函数处理。

<br>

### 1.1、绘制点形

我们可以使用以下形式在R语言中绘制散点或单个字符，注意这里的**col、bg、cex**参数的意义与在**par**函数中的意义不同。

`points(x, y = NULL, pch = 1, col = "black", bg = "black", cex = 1, ...)`

**pch**参数即点形的类型，取值为**0:25**时分别对应以下图形，取值为**32:127**时表示绘制相应的ASCII字符，……
**col**参数即点形的（轮廓）颜色
**bg**参数即点形的填充颜色，仅当**pch**取值为**21:25**时有效
**cex**参数即点形的缩放程度

```
par(mar = rep(0, 4))
plot.new(); plot.window(c(-1, 1), c(-1, 1))
legend(0, 0, legend = 1:25, pch = 1:25, title = "pch (plotting 'character') of 1:25",
       xjust = 0.5, yjust = 0.5, x.intersp = 2, 
       adj = c(1, 0.5), ncol = 5)
```

<br>

### 1.2、绘制线条

R语言中可以绘制直线、折线、曲线，这些线形都可以通过**par**函数中的**col、lty、lwd**参数设置线条颜色、线条类型、线条宽度。

```
x <- c("blank", "solid", "dashed", "dotted", "dotdash", "longdash", "twodash", "AA", "151A1F")
par(mar = rep(0, 4))
plot.new(); plot.window(c(-1, 1), c(-1, 1))
legend(0, 0, legend = x, lty = x, title = "lty (line type)",
       xjust = 0.5, yjust = 0.5, x.intersp = 5, 
       adj = c(1, 0.5), ncol = 3)
```

首先我们可以通过以下形式绘制一条从点**(x0, y0)**到点**(x1, y1)**的直线。

`segments(x0, y0, x1 = x0, y1 = y0, ...)`

**x0、y0、x1、y1**参数即直线的起止位置

<br>

其次我们可以通过以下形式绘制一条类似于回归线的直线，这里我们必须指定直线的表达式。注意以这种方式绘制的直线没有起始位置与终止位置，直线可以贯穿整个主图区域。

`abline(a, b, h, v, untf = FALSE, ...)`

**a、b**参数即直线的**斜率**与**截距**
**h、v**参数即水平、垂直方向的直线对应的Y轴、X轴坐标
**untf**参数表示当坐标轴以对数的形式表示时，是否将直线也作相应的转化（例如：当X轴取对数时，将`y = a*x + b`转化为`y = a*log(x) + b`）

<br>

接下来我们还可以通过以下形式绘制一条折线，折线会经过数据集**x、y**中的每一个点。此外该函数还可以绘制虚线折线、阶梯线等。

`lines(x, y, type = "l", ...)`

**x、y**参数即折线中每个点的位置
**type**参数即图形类型，相当于**plot**函数中的**type**参数

<br>

最后我们还可以通过以下形式绘制一条曲线，但我们必须首先要知道曲线的表达式。注意这里的曲线本质上依然是折线，只不过当折线任意的两个相邻点之间距离非常近时，折线就会趋近于曲线。

`curve(expr, from, to, n = 101, add = FALSE, ...)`

**expr**参数即曲线的表达式**f(x)**，如`sin(x)`
**from、to**参数即曲线X轴坐标的起止位置
**n**参数即需要有多少个点来确定当前曲线
**add**参数即是否添加在原有的图形上

<br>

另外我们还可以通过以下形式绘制一条**箭头线**，注意这里的箭头并不是实心箭头，可以看作是由两条直线构成的。

`arrows(x0, y0, x1 = x0, y1 = y0, length = 0.25, angle = 30, code = 2, ...)`

**x0、x1、y0、y1**参数表示箭头线的起止位置
**length**参数表示箭头的大小（英寸）
**angle**参数表示箭头的开口角度，取值范围在**0：180**
**code**参数表示箭头的位置，取值为**1、2、3**时分别表示在起始位置、终止位置、两端绘制箭头

<br>

### 1.3、绘制多边形

R语言中的多边形，不仅可以使用纯色填充，还可以使用**阴影线**填充，因此以下参数在绘制多边形的底层函数中，与在**par**函数中的意义略有不同。

**density、angle**参数即多边形中阴影线的密集程度及倾斜程度
**col**参数即多边形的填充色或阴影线的颜色
**border**参数即多边形边框的颜色
**lty、lwd**参数即多边形边框及阴影线的线条类型、线条宽度

<br>

首先我们可以通过以下形式绘制一个矩形，但这种方式只能绘制与坐标轴水平/垂直的矩形，不能倾斜。

`rect(xleft, ybottom, xright, ytop, ...)`

**xleft、ybottom、xright、ytop**参数表示矩形的起止位置

<br>

其次我们可以通过以下形式绘制一个多边形，多边形会逐一连接数据集**x、y**中的每一个点，并将首尾两点相连，我们可以在数据集中插入**NA**值，来绘制多个多边形。如果多个多边形重叠，填充时需要判断哪些是“内部”空间。

`polygon(x, y = NULL, ..., fillOddEven = FALSE)`

**x、y**参数即多边形中每个顶点的位置
**fillOddEven**参数表示使用**奇偶原则**或**非零环绕原则**填充多边形

多边形与圆之间的关系，类似于折线与曲线。所以**polygon**函数也可以绘制圆形、扇形等包含弧线的平面几何，不过这里需要我们自己计算出弧线中每个点的位置，比如我们可以通过以下代码绘制圆环。

```R
# 计算圆环上每个点的坐标
v <- seq(0, 2*pi, length.out = 360)
x1 <- sin(v); y1 <- cos(v)
x2 <- 0.8 * rev(x1); y2 <- 0.8 * rev(y1)
# 绘制圆环
op <- par(mar = rep(4, 4), fin = rep(min(dev.size()), 2))
plot.new(); plot.window(xlim = c(-1, 1), ylim = c(-1, 1))
polygon(c(x1, x2), c(y1, y2), col = 1, border = NA)
par(op)
```

<br>

特别的我们可以通过以下形式，使用**样条插值法**，绘制样条曲线或多边形。注意以这种方式绘制的多边形不支持使用阴影线填充。

`xspline(x, y = NULL, shape = 0, open = TRUE, repEnds = TRUE, ...)`

**x、y**参数即样条曲线或多边形中每个连接点的位置
**shape**参数即线条经过每个连接点时计算样条插值的方式，取值范围在**-1:1**
**open**参数即是否开口（将首尾两点连接）
**repEnds**参数即是否重复首尾两个连接点，对于闭合型多边形非常重要

```
plot(c(0,1), c(0,1), type = "n", axes = FALSE, xlab = "", ylab = "")
x <- c(0.2, 0.2, 0.8, 0.8)
y <- c(0.8, 0.2, 0.2, 0.8)
points(x, y)
xspline(x, y, border = "black", shape = 0)
xspline(x, y, border = "red", shape = -1)
xspline(x, y, border = "green", shape = 1)
legend("top", horiz = TRUE, title = "shape of xspline",
       legend = -1:1, lty = 1, col = c("red", "black", "green"))
```

<br>

### 1.4、绘制文字

R语言中绘制文字的底层函数着重于运用在统计类图形中，不能通过字号来调整字体大小，而只能使用缩放倍率；只能按照坐标轴的水平或垂直方向放置，而不能以任意角度旋转。

这些绘制文字的底层函数，都可以通过**par**函数中的**adj、cex、col、font**参数设置对齐方式、缩放倍数、颜色、加粗与倾斜效果。

<br>

首先我们可以通过以下形式绘制统计类图形的各种标题，注意以下标题一般均绘制在边距位置。

`title(main = NULL, sub = NULL, xlab = NULL, ylab = NULL, line = NA, outer = FALSE, ...)`

**main、sub、xlab、ylab**参数即需要绘制的标题、副标题、X轴坐标标题、Y轴坐标标题
**line**参数可以设定这些标题距离主图区域的间隔，参考`par("mgp")`
**outer**参数即标题是否应该绘制在外边距中
      
<br>

其次我们还可以通过以下形式，在主图区域的任意位置绘制文字，不过这种形式通常用于绘制图形标签。

`text(x, y = NULL, labels = seq_along(x$x), pos = NULL, offset = 0.5, ...)`

**x、y**参数即文字的绘制位置
**labels**参数即需要绘制的文字
**pos**参数即文字相对于点**c(x, y)**的放置位置，取值为**1：4**分别表示**下、左、上、右**
**offset**参数即文字相对于放置位置（由**pos**参数设置）的偏移量
      
<br>

最后我们还可以通过以下形式，将文字绘制到边距区域。注意调整文字放置位置的方式（参考**at、adj、padj**参数）与以上函数不同。

`mtext(text, side = 3, line = 0, outer = FALSE, at = NA, adj = NA, padj = NA, ...)`

**text**参数即需要绘制的文字
**side**参数即文字需要被绘制在外边距的什么位置，取值为**1、2、3、4**分别表示**下、左、上、右**
**line、outer**参数，同**title**函数中的相应参数
**at**参数即文字的X轴或Y轴坐标位置
**adj**参数即文字在主方向（对于上/下方文字即横向，对于左/右方文字即纵向）上的对齐方式，取值范围在**0-1**之间，**0**表示靠左/下对齐，**1**表示靠右/上对齐
**padj**参数即文字在辅方向上的对齐方式，取值范围在**0-1**之间，**0**表示靠右/上对齐，**1**表示靠左/下对齐

<br>

### 1.5、绘制图像

我们可以通过以下形式，将一个由矩阵表示的**栅格图**绘制出来。这种方式如果结合图像文件读取函数，则可以将本地图片绘制到绘图设备中。

`rasterImage(image, xleft, ybottom, xright, ytop, angle = 0, interpolate = TRUE, ...)`

**image**参数即**raster**类型的图像对象，由颜色值构成的矩阵
**xleft、ybottom、xright、ytop**参数即图像的起止位置
**angle**参数即图像的倾斜角度
**interpolate**参数即是否使用线性渐变的方式填充颜色

<br>

## 2、常见统计类图形

统计类图形本质上是将数据的统计信息映射到图形的某种属性（位置、形状、大小、颜色等）。因此一幅图形总是可以包含多种统计信息，但以下统计类图形，我们都是从其可以包含的最主要的统计信息，展开介绍的。

<br>

### 2.1、茎叶图与直方图

茎叶图常用于一维数据，可以帮助我们快速掌握数据的分布情况。茎叶图实际上并不是一种图像，而是可以直接在命令行输出的一段统计信息。

R语言中的茎叶图会首先将一串数值前端补零保证每个数值位数相同，再四舍五入保留最高位的两位数字分别作为主干部分和枝叶部分的特征值，最后再按主干部分的数字归纳展示。注意主干部分的数字不是连续的，枝叶部分的数字会有歧义。

```R
> stem(lh, scale = 0.25)

  The decimal point is at the |

  1 | 45577888999
  2 | 0001112222333344445667777999
  3 | 001223455
```

<br>

直方图展示的往往是一维连续型变量的统计信息（频率、比率等），这一点与茎叶图的理念十分相似，也常被用于展示数据的分布情况。但茎叶图可以在一定程度上保留原始数据，直方图则只保留统计汇总之后的信息。

```
hist(lh, breaks = 5, xlab = "黄体生成素水平", ylab = "频次",
     main = "黄体生成素水平（10分钟测量一次）")
```

<br>

### 2.2、柱形图与扇形图

柱形图与扇形图都可以用于展示是二维数据，即分类变量中的某个类别，对应连续变量中数值的大小。但二者的使用方式略有不同，**barplot**函数中需要分别指定一个连续变量和一个分类变量，而**pie**函数中则只需要指定一个连续变量，分类变量可以作为连续变量的**names**属性提供。

注意柱形图与直方图从图形方面来看是一样的，但直方图需要先统计一维数据的频率、比率等，再决定柱形的高低，而柱形图中柱形的高低则是由连续变量中数值的大小决定的。

```
# 绘制扇形图
sales <- c(0.12, 0.3, 0.26, 0.16, 0.04, 0.12)
names(sales) <- c("Blueberry", "Cherry", "Apple", 
                  "Boston Cream", "Other", "Vanilla Cream")
pie(sales)

# 绘制柱形图
barplot(GNP ~ Year, data = longley)
```

<br>

### 2.3、箱线图

类似直方图，箱线图也可以用于展示一维数据的分布情况。箱线图还常被用于对比多组数据的整体情况。在箱线图中，矩形中部的直线代表中位数；中位数线到矩形的上、下边的距离分别代表上、下四分位距；中位数线到到矩形之外的上、下须线之间的距离，则代表**2.5**倍的上、下四分位距；超出上、下须线的数值可以被看作**特异值**，以点的形式表示。

```
# 绘制箱线图
boxplot(count ~ spray, data = InsectSprays, col = "lightgray")
```

<br>

### 2.4、雷达图、玫瑰图、各种分组图形

雷达图、玫瑰图、以及各种分组图形，展示统计信息的方式十分类似。如果我们有一个矩阵，矩阵的每一行是一条观测值，每一列是一个观测纬度，这些图形可以方便我们了解每条观测值在各个纬度的表现情况。

```
USJudge <- apply(USJudgeRatings[1:5, ], 2, function(x) x/max(x))
# 绘制雷达图
stars(USJudge, locations = c(0, 0), scale = FALSE, key.loc =  c(0, 0), 
      col.lines = rainbow(5), main = "US Judge Ratings")
# 绘制玫瑰图
stars(USJudge, draw.segments = TRUE, scale = FALSE, 
      nrow = 2, col.segments = rainbow(12), 
      labels = NULL, main = "US Judge Ratings")
      
# 绘制分组折线
matplot(USJudge, type = "l")
```

<br>

### 2.5、等高线图、地势图、密度图、三维曲面

等高线图、地势图、密度图、三维曲面等类型的图形，都需要以点**x、y、z**指明坐标轴中的某个点，以及相应位置的高度、密度等。当然可以是一个矩阵，其行列位置分别对应X轴、Y轴的位置，数值则表示该点对应的的高度、密度等。

```
# 绘制等高线图
contour(volcano)
# 绘制地势图
x <- 10*1:nrow(volcano)
y <- 10*1:ncol(volcano)
filled.contour(x, y, volcano)
# 绘制密度图
image(volcano)
# 绘制三维曲面
persp(volcano, theta = 30, phi = 30)
```

<br>


stripchart     一维散点图

mosaicplot     马赛克图，图形中矩形的大小由矩阵相应位置的数值决定
spineplot      脊柱图，柱形图的变种，图形中柱形高低是由分类变量的频率决定的

```R
# 绘制一维散点图
stripchart(decrease ~ treatment, main = "decrease ~ treatment",
           vertical = TRUE, log = "y", data = OrchardSprays)
           
# 绘制马赛克图
mosaicplot(~ Sex + Age + Survived, data = Titanic, color = c("red", "black"))

# 绘制脊柱图
treatment <- factor(rep(c(1, 2), c(43, 41)), 
+                     labels = c("placebo", "treated"))
improved <- factor(rep(c(1, 2, 3, 1, 2, 3), c(29, 7, 7, 13, 7, 21)),
+                    labels = c("none", "some", "marked"))
spineplot(improved ~ treatment)
```


pairs          散点图矩阵，方便分析数据框中任意两个变量之间的关联关系
coplot         散点图矩阵，方便分析数据框中多个变量之间的关联关系
cdplot         散点图矩阵，方便分析数据框中多个变量之间的关联关系
panel.smooth   绘制散点图矩阵等图形中，两个变量之间的趋势线

dotchart       高纬散点图，纵轴是位置，横轴是取值，
smoothScatter  密度散点图
sunflowerplot  向日葵散点图

```
dotchart(t(VADeaths), xlim = c(0,100),
+          main = "Death Rates in Virginia - 1940")
```

symbols        绘制圆形、正方形（1纬）、矩形（1纬）、温度计形（3-4纬）、箱线形（5纬）

fourfoldplot   绘制 **4象限图**
assocplot      二维交互表中变量关联图，颜色是由皮尔逊残差决定的




<br>

{{< note "思考思考" "#e6e6ff" >}}
- ？
- ？
- ？

{{< /note >}}xie

<br>
