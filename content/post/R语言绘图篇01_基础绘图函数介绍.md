---
title: R语言中的绘图函数
date: 2019-11-09
categories:
  - R语言
  - 绘图
tags:
  - R语言绘图
keywords:
  - R语言
  - 绘图
  - plot
thumbnailImagePosition: left
thumbnailImage: https://s2.ax1x.com/2019/11/09/Mef42t.png
---

一图胜千言，作为一门专注于数据统计的计算机语言，必须拥有强大的数据可视化能力。这篇文章我们将介绍R语言本身的绘图函数及绘图方式。

<!--more-->

<!-- toc -->

R语言中的{{< hl-text primary >}}plot{{< /hl-text >}}函数拥有强大的绘图能力，一般只需要一行代码即可展示出可视化结果。但对于图像中细节（颜色分配、图例设置等）的控制，往往需要耗费我们大量的精力。R语言中有大量函数、参数可以帮助我们设置图像细节，然而，要做到对图像细节的精准控制，首先需要我们了解一幅统计类图像中包含哪些可调节的细节：

```R
op <- par(no.readonly = TRUE)
# 绘制主图框架
par(oma = rep(1, 4), mar = c(5, 4, 4, 0) + 0.1, fig = c(0, 0.8, 0, 1))
plot(x = iris$Petal.Length, y = iris$Petal.Width, type = "n",
     main = "鸢尾花观测数据", sub = "不同亚种鸢尾花花瓣长度与宽度统计", 
     xlab = "花瓣长度", ylab = "花瓣宽度")
# 计算组别
groups <- unique(iris$Species)
cols <- rainbow(length(groups))
# 绘制散点
for (i in 1:length(groups)) {
  with(subset(iris, Species == groups[i]),
    points(Petal.Length, Petal.Width, col = cols[i])
  )
}
# 绘制设备区域、图像区域边框
box(which = "outer", col = 'red', lwd = 2)
box(which = "figure", col = 'blue')
# 绘制图例
par(fig = c(0.8, 1, 0, 1), mar = rep(0, 4))
plot.window(0:1, 0:1)
legend(0.5, 0.5, groups, pch = 1, col = cols,  title = "鸢尾花亚种",
       xpd = TRUE, yjust = 0.5, xjust = 0.5)
# 绘制当前图像区域边框
box(which = "figure", col = 'blue')
# 恢复默认绘图设置
par(op)
```

{{< image classes="fancybox nocaption clear" src="https://s2.ax1x.com/2019/11/09/MegSW6.png" >}}

<br>

## 1、默认绘图参数

在R语言中，绝大多数的控制绘图细节的参数都可以由{{< hl-text primary >}}par{{< /hl-text >}}函数获取、设置。以下是**par**函数的全部参数：

- 边距属性

  - **oma**参数，以`c(bottom, left, top, right)`的形式设置图形的下、左、上、右外边距各占多少行，默认为`c(0, 0, 0, 0)`。此外**omi**参数还可以使用英寸为单位设置外边距。
  - **mar**参数，以`c(bottom, left, top, right)`的形式设置图形的下、左、上、右边距各占多少行，默认为`c(5, 4, 4, 2) + 0.1`。此外**mai**参数还可以使用英寸为单位设置边距。
  - **mex**参数，设置边距的缩放比例，默认为1。与**mar**参数功能类似，但**mex**参数不会改变字体大小。
  - **mgp**参数，设置坐标轴标题、标签、刻度到主图区域的距离各有多少行（**mex**参数的倍数），默认为`c(3, 1, 0)`。
  - **ylbias**参数，设置边距区域文字距离主图区域的位置。仅用于{{< hl-text primary >}}axis、mtext{{< /hl-text >}}函数。

- 绘图区域

  - **din**参数，设备区域的大小，即宽度、高度各占多少英寸。只能被读取。
  - **fig**参数，设置图像区域在设备区域中的位置及相对比例，默认为`fig = c(0, 1, 0, 1)`，即占满整个设备区域。设置该参数时默认会新建一幅图像，如果需要在原图像上添加新图像，则需要设置`new = TRUE`。此外**omd**参数还可以通过调整外边距实现这一功能。
  - **fin**参数，设置图像区域的大小，即宽度、高度各占多少英寸。设置该参数时默认会新建一幅图像。
  - **bty**参数，控制主图区域边框的类型。取值可以是**o、l、7、c、u、]**，代表全边框或朝某方向开口的边框。
  - **plt**参数，设置主图区域在图像区域中的位置及相对比例。
  - **pin**参数，设置主图区域的大小，即宽度、高度各占多少英寸。
  - **pty**参数，设置主图区域的类型，取值为**s、m**分别表示方形主图区域、最大主图区域。

- 图像布局

  - **mfcol、mfrow**参数，以`c(nr, nc)`的形式设置图像布局，即一幅图像中包含多少行、列的子图像。二者作用相同，设置时应任选其一。更多高级属性需要借助{{< hl-text primary >}}layout{{< /hl-text >}}函数实现。当然我们可以借助{{< hl-text primary >}}split.screen、screen、erase.screen、close.screen{{< /hl-text >}}设置图像布局。
  - **mfg**参数，以`c(i, j)`的形式设置当前子图像应该绘制在图像区域的哪个窗格。使用**mfcol、mfrow**参数设置图像布局时，子图像默认按照从左到右、从上到下的顺序绘制，**mfg**参数可以改变当前图像的默认绘制位置。
    
- 坐标轴属性

  - **tck**参数，设置坐标轴刻度相对于图像区域的缩放比例。取值范围应该在-1至1之间，正数表示向主图区域延伸，负数表示向边距延伸，取值为1相当于绘制网格线。此外**tcl**参数还可以设置坐标轴刻度相对于文字行高的缩放比例，默认为**-0.5**。
  - **usr**参数，以`c(x1, x2, y1, y2) `的形式设置X、Y轴的坐标取值上下限。
  - **las**参数，设置坐标轴标签的方向，0-3分别表示与坐标轴平行、与图像水平方向平行、与坐标轴垂直，与图像水平方向垂直。
  - **lab**参数，以`c(x, y, len)`的形式设置X、Y坐标轴刻度数量，及坐标轴标签长度（目前尚未实现），默认为`c(5, 5, 7)`。
  - **xaxp、yaxp**参数，以`c(x1, x2, n)`的形式设置X、Y轴坐标轴刻度的起始位置、终止位置、以及二者之间的刻度数量。当X、Y轴以对数的形式绘制时，**n**的取值只能为1-3之间的整数，分别表示刻度应为`{1}、{1, 5}\ {1, 2, 5}`乘于10的指数次方。
  - **xaxs、yaxs**参数，根据X、Y轴的数值范围，或者**xlim、ylim**设定的值，决定坐标轴刻度默认计算方式。取值为**r**表示将数值范围扩大百分之四，再从中寻找和使得刻度；取值为**i**表示在数值范围内寻找合适的刻度。
  - **xaxt、yaxt**参数，设置X、Y轴的绘制方式。**n**表示不绘制，**s**表示绘制标准的X、Y轴。
  - **xlog、ylog**参数，设置是否以对数的形式绘制X、Y轴。直接设置这些值可能无效，需要以类似`plot(*, log = "x")`的形式使用。

- 文字属性

  - **cin**参数，图像中文字的大小，即宽度、高度各占多少英寸。此外**cra**参数还可以使用像素为单位获取文字大小，**csi**参数相当于`par("cin")[2]`。只能被读取。
  - **cxy**参数，图像中文字相对于主图区域的大小，即宽度、高度占的比例。只能被读取。
  - **ps**参数，设置图像中文字的大小，即每个文字占多少像素点。不会影响到边距。
  - **family**参数，设置图像中文字的字体类型，如**serif、sans、mono**等。
  - **font**参数，设置图像中文字的样式，1-5分别表示常规、加粗、倾斜、加粗并倾斜、符号字体。此外**font.axis、font.lab、font.main、font.sub**参数还可以分别设置坐标轴刻度文字、坐标轴标签、标题、副标题的文字样式。
  - **crt**参数，设置图像中单个字符的旋转角度，取值范围在0-360之间。
  - **srt**参数，设置图像中文字的旋转角度，取值范围在0-360之间。仅对于{{< hl-text primary >}}text{{< /hl-text >}}函数有效。
   - **adj**参数，调整{{< hl-text primary >}}text、mtext、title{{< /hl-text >}}函数生成的文字在图形中的位置，取值为0表示左对齐；0.5表示居中；1表示右对齐。对于**text**函数，也可以使用`adj = c(x, y)`的形式，调整文字水平和垂直方向。
  - **ann**参数，上层函数调用{{< hl-text primary >}}plot.default{{< /hl-text >}}时，是否将其设定的标题传递给{{< hl-text primary >}}title{{< /hl-text >}}函数（决定了是否绘制这些标题）。
  - **lheight**参数，设置图像中每行字体的缩放比例（行高）。
  
- 散点属性

  - **pch**参数，设置图像中点的形状。**pch**参数可以是0-126之间的整数，也可以是相应的字符。更多高级属性需要借助{{< hl-text primary >}}points{{< /hl-text >}}函数实现。

- 线条属性

  - **lwd**参数，设置图像中线条的宽度，默认为1。
  - **lty**参数，设置图像中线条的类型，1-6分别表示**blank、solid、dashed、dotted、dotdash、longdash、twodash**，其中只有1为实线，其余均为虚线。此外我们也可以使用由2-8位（必须是偶数位）16进制数字组成的字符串，设置虚线的断续位置。
  - **lend**参数，设置图像中线条的结尾方式，0-2分别表示圆形、无类型、方形（**round、butt、square**）的结尾方式。
  - **ljoin**参数，设置图像中不同线条的连接方式，0-2分别表示圆形、冠状、斜角（**round、mitre、bevel**）的连接方式。
  - **lmitre**参数，设置图像中线条的斜接极限，两个线条十分接近时冠状的连接方式将变为斜角连接方式。取值必须大于1，默认为10。
  
- 其它参数

  - **bg**参数，设备区域背景色，默认为白色。
  - **fg**参数，设备区域前景色，用于坐标轴及主图区域边框等，默认为黑色。
  - **cex**参数，设置图像中文字和符号的缩放比例，默认为1。此外**cex.axis、cex.lab、cex.main、cex.sub**参数还可以分别设置坐标轴标签、坐标轴标题、标题、副标题的缩放比例（相对于**cex**）。
  - **col**参数，设置图像中图形元素 （点、线等）的颜色。此外**col.axis、col.lab、col.main、col.sub**参数还可以分别设置坐标轴标签、坐标轴标题、标题、副标题的颜色。
  - **ask**参数，绘制图像前请求用户确认（在命令行中显示`按<Return>键来看下一个图:`）。 
  - **new**参数，当高水平绘图函数（这类函数会调用{{< hl-text primary >}}plot.new{{< /hl-text >}}新建图像窗口）被调用时，决定是否以当前图像窗口作为 *新窗口* 。
  - **page**参数，当高水平绘图函数被调用时，是否新建一个图像窗口。只能被读取。
  - **xpd**参数，设置当前图像的相对位置。取值为**FALSE、TRUE、NA**分别表示相对于主图窗口、图像窗口、设备窗口。对于图例十分有用，更多高级用法需要借助{{< hl-text primary >}}clip{{< /hl-text >}}函数实现。
  - **smo**参数，设置图像中弧线的弯曲程度。目前尚未实现。
  - **err**参数，当图形中的点超出主图区域时发出警告。目前尚未实现。
  - **mkh**参数，当**pch**参数取值为整数时，设置图形中点的高度应该占多少英寸。在R语言中没有任何作用。


在修改这些参数时我们需要格外小心，因为之后所有的图形都将根据修改后的参数绘制，除非新建一个绘图设备（参考**dev.new**函数）。为了避免修改了某些绘图设置之后无法还原，我们可以先将默认绘图参数保存起来，绘图结束后再恢复这些设置。

```R
op <- par(no.readonly = TRUE)
...
par(op)
```

<br>

## 2、高等绘图函数

R语言中的高等绘图函数，指的是可以单独完成绘图任务的函数。这些函数在执行时往往需要经历以下几个步骤：

- 首先判断有没有可用的图形化设备，如果没有则开启一个新的图形设备（参考{{< hl-text primary >}}dev.new{{< /hl-text >}}函数）。
- 修改默认图形参数，将接收到的修改绘图细节的函数传递给**par**函数。
- 初始化绘图区域，填充设备区域背景色（参考{{< hl-text primary >}}plot.new{{< /hl-text >}}函数）。
- 设置图形坐标系，决定坐标轴上下限（主图区域）（参考{{< hl-text primary >}}plot.window{{< /hl-text >}}函数）。
- 将接收到的绘图参数传递给底层绘图函数，并由底层函数将图形绘制到当前图形化设备中。

R语言中最常见的高等绘图函数应该是**plot**函数。**plot**函数是一个分发函数，往往只需要我们提供数据，即可找到适合该类型数据的绘图方法，并实现可视化（比如`plot(co2)`）。此外我们还可以设置**plot**函数的**type**参数来调用特定的绘图类型，注意不同绘图类型对数据的展示方式也是不同的，比如直方图只能展示一维数据，而其它绘图类型均展示二维数据，所以一些绘图方法可能没有完全实现这些绘图类型，以下是所有可用的绘图类型：

| 参数取值          | 解释说明                                                      
|:------------------|:-----------------------------------------------------------------
| **p**             | 表示散点图
| **l**             | 表示线形图
| **b**             | 表示点线图，线不穿过点
| **c**             | 表示虚线图，相当于**b**中的线条
| **o**             | 表示点线图，线穿过点
| **h**             | 表示直方图
| **s**             | 表示阶梯图，按先水平再垂直的方向绘制
| **S**             | 表示阶梯图，按先垂直再水平的方向绘制
| **n**             | 表示在主图区域不绘制任何内容
  
<br>

## 3、底层绘图函数

R语言中的底层绘图函数，指的是必须依赖高等绘图函数建立的图形坐标系，才能绘图（决定图形在图像中的位置）的函数。底层绘图函数只能在当前绘图设备中添加图形，因此可以允许我们在一幅统计图中展示更丰富的信息。以下是R语言中的部分绘图函数及其功能：

| 函数              | 解释说明                                                      
|:------------------|:-----------------------------------------------------------------
| title             | 添加标题、副标题、坐标轴标题
| mtext             | 在边距处添加文字
| text              | 在图形中添加文字（图形中点的标签）
| legend            | 添加图例
| axis              | 添加坐标轴
| rug               | 添加X轴刻度须线（图像中的每个点对应一个刻度须线）
| grid              | 添加网格线
| box               | 添加边框
| points            | 添加散点
| segments          | 添加两点之间的连接线
| abline            | 添加直线（需要指定直线函数的系数）
| lines             | 添加折线
| curve             | 添加曲线（需要指定曲线函数）
| arrows            | 添加箭头
| rect              | 添加矩形
| polygon           | 添加多边形
| polypath          | 添加多边形路径
| xspline           | 添加样条曲线或由样条曲线围成的平面图形

<br>

不同底层绘图函数使用起来千差万异，这里我们以{{< hl-text primary >}}legend{{< /hl-text >}}函数为例，介绍图例的绘制方式。

R语言中的图例本身也是个普通的图形，不能根据主图形中的颜色、组别等属性自动生成，而需要我们手动绘制。图例中可以将形状与标签配对，指明主图形中特定的形状对应的意义。图例中的形状可以有散点、线条、矩形，要生成**n**个 *形状-标签*，则需要我们指定**n**个相应形状的属性，及**n**个标签。此外图例中的绘图细节也可以通过参数调整，而且许多参数默认调用了**par**函数中相应的参数，以下为**legend**函数中的全部参数：

- **x、y**参数，设置图例需要被放置的位置（默认为图例左上顶点在图像中的位置）。
- **xjust、yjust**参数，设置图例相对点`c(x, y)`，在水平（垂直）方向上的对齐方式，取值为0表示左（上）对齐；0.5表示居中；1表示右（下）对齐。
- **inset**参数，使用关键字（**center、left、right、top、bottom、bottomright、...**）设置图例位置时，设置图例左上顶点距离主图左上角顶点的间距，相对于主图区域的缩放比例。
- **legend**参数，以字符串或命令集（**expression**）数组的形式，设置的图例中的标签。
- **bty**参数，设置图例边框的绘制方式，**o、n**分别表示全边框、无边框。此外**box.lty, box.lwd, box.col**参数还可以设置图例边框的线条形状、宽度、颜色，只有当`bty = "o"`时有效。
- **bg**参数，设置图例背景色。只有当`bty = "o"`时有效。
- **title**参数，设置图例中的标题。此外**title.col、title.adj**参数还可以调整图例标题颜色及位置。
- **text.width、text.col、text.font**参数，设置图例中标签的宽度，颜色，字体类型。
- **adj**参数，以`c(x, y)`的形式，调整图例中标签的位置。
- **fill**参数，设置图例中矩形形状的填充颜色。
- **density**参数，设置图例中矩形形状中的阴影线的密集程度。取值范围在0-100之间，表示百分比。此时**fill**参数设置的是阴影线的颜色。
- **angle**参数，设置图例中矩形形状中的阴影线的倾斜角度。
- **border**参数，设置图例中矩形形状的边框颜色。
- **col**参数，设置图例中散点或线条形状的颜色。
- **lty、lwd**参数，设置图例中线条形状的类型、宽度。
- **seg.len**参数，设置图例中线条形状的长度相对于字符宽度的缩放比例。
- **pch、pt.bg、pt.cex、pt.lwd**参数，设置图例中散点形状的类型、填充色、缩放比例、行高。 
- **merge**参数，设置图例中出现多个形状时，是否将它们合并。
- **ncol**参数，设置图例中的对象应该排列成多少列。默认为1，即按垂直方向依次放置。
- **horiz**参数，设置是否将图例中的对象按水平方向依次放置。
- **x.intersp、y.intersp**参数，设置图例中水平（垂直）方向不同元素之间距离的缩放比例。
- **trace**参数，设置是否在命令行中打印生成图例时的计算过程。
- **plot**参数，设置是否绘制图例，若取值为**FALSE**将返回图例的位置及大小。

<br>

{{< note "思考思考" "#e6e6ff" >}}
- R语言中出现以下错误的原因是？ 
```Error in plot.new() : figure margins too large```
- 如何设置图例中的标签靠右对齐？
- 如何形成固定的绘图风格？

{{< /note >}}

<br>
